#!/usr/bin/env bash
set -o errexit

echo "๐ Iniciando build de Estudify (Render) ..."

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# INSTALAR DEPENDENCIAS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo "๐ฆ Instalando dependencias del proyecto..."
pip install --upgrade pip
pip install -r requirements.txt

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# MIGRACIONES
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo "๐๏ธ Ejecutando migraciones..."
python manage.py migrate --no-input

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# CREAR ADMIN AUTOMรTICAMENTE (opcional por env var)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
if [ "${SEED_INITIAL_DATA:-0}" = "1" ]; then
  echo "๐ฑ Ejecutando seed de datos iniciales..."
  python manage.py seed_initial_data || true
else
  echo "โ๏ธ Seed inicial deshabilitado. Para activarlo usa SEED_INITIAL_DATA=1"
fi

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ARCHIVOS ESTรTICOS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo "๐ Recolectando archivos estรกticos..."
python manage.py collectstatic --no-input

echo "๐ Build completado exitosamente!"
